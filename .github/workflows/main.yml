name: Django_tests
on: [pull_request]
jobs:
  test_project:
    runs-on: ubuntu-latest
    env:
      # Fixed dummy values for CI to avoid missing-secret failures.
      # These are safe for CI runs and are not production secrets.
      SECRET_KEY: "ci-secret-key-please-change"
      CLOUDINARY_CLOUD_NAME: "demo_cloud"
      CLOUDINARY_API_KEY: "demo_api_key"
      CLOUDINARY_API_SECRET: "demo_api_secret"
      # Use the temporary sqlite DB when running pytest
      TEMP_DB: "True"

    steps:
      - uses: actions/checkout@v4
      - name: Set up Python 3.12
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"
      - name: Install pipenv and dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pipenv
          pipenv sync --dev
      - name: Run tests with pytest
        run: |
          # Run pytest directly so the command exists in the virtualenv
          pipenv run pytest -q
