# All Patients PDF Reports Endpoint

## API Endpoint: `/reports/patients`

### Overview

- **Description**: Generates individual PDF consultation reports for all patients who have consultations and returns them as a single ZIP file. Each PDF contains all consultations for that patient, formatted the same way as individual patient consultation PDFs.
- **HTTP Method**: GET
- **Authentication**: Required (based on your existing auth setup)

---

### Request Details

#### URL Parameters
None

#### Query Parameters
None

#### Request Body
None

---

### Response Details

#### Response Structure

- **Status Codes**: 
  - 200: Success - Returns ZIP file
  - 500: Server error during PDF generation

- **Content-Type**: `application/zip`

- **Response**: A ZIP file containing individual PDF files, one for each patient who has consultations.

#### ZIP File Structure

The ZIP file contains multiple PDF files named:
```
consult_report_<VILLAGE_PREFIX><PATIENT_ID>.pdf
```

For example:
- `consult_report_SV0001.pdf`
- `consult_report_SV0002.pdf`
- `consult_report_TK0015.pdf`

Each PDF contains:
- Patient identification and name
- All consultations for that patient, including:
  - Consultation date
  - Past medical history
  - Consultation notes
  - Diagnoses
  - Plan
  - Referral information (if applicable)
  - Remarks

---

### Usage Example

#### Request
```bash
GET /api/patients/reports/pdf/all/
```

#### Response
Returns a downloadable ZIP file named `all_patient_reports.zip` containing all patient consultation reports.

---

### Implementation Details

#### Processing on the Backend

- **Where**: `api.views.pdf_all_patients_view.PdfAllPatientsView`
- **Service**: `api.services.pdf_consult_service.generate_all_patients_pdfs_zip()`
- **How**:
  1. Queries all patients who have at least one consultation
  2. For each patient, retrieves all their consultations ordered by date
  3. Generates a PDF using the same format as individual patient PDFs
  4. Adds each PDF to a ZIP archive
  5. Returns the ZIP file as a downloadable response

#### Error Handling

- If a PDF generation fails for an individual patient, the error is logged and the process continues with the remaining patients
- Only patients with consultations are included in the output

---

### Notes

- This endpoint can take some time to process if there are many patients with consultations
- The ZIP file size will depend on the number of patients and their consultation history
- The PDF format matches exactly what is generated by the individual patient consultation PDF endpoint
- PDFs are generated in memory and streamed, so no temporary files are created on disk
